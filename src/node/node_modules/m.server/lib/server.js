const path 					= require("path"),
			favicon 			= require('serve-favicon'),
			bodyParser 		= require('body-parser'),
			cookieParser 	= require('cookie-parser'),
			compression 	= require('compression'),
			views 				= require('m.views'),
			cache					= require('m.cache');

let 	setServer			= require(path.join(Config.rootProject, "node/src/"));
	
module.exports.start = function(app, express, router){

	// gzip压缩
	app.use(compression());
	
	// favicon.ico
	app.use(favicon(path.join(Config.rootStartProject(), 'favicon.ico')));

	// 自定义中间件，作用与浏览器缓存
	app.use(cache);

	// 配置静态路径
	app.use(express.static(Config.rootStartProject()));
	
	// bodyParser中间件，用于更好的获取请求的数据
	app.use(bodyParser.urlencoded({ extended: false }));
	app.use(bodyParser.json({limit: '10mb'}));

	// set cookie
	app.use(cookieParser());

	// 配置默认模板，目前为html
	views.init(app, router);

	// set server
	setServer.start(app, router);
}



